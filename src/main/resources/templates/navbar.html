<!DOCTYPE html>
<head>
<meta charset="UTF-8">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet" type="text/css"
	th:href="@{/css/common/navbar.css}">
</head>
<body>
	<th:block th:fragment="headerFragment">
		<div class="content">
			<!-- navbar-1: position relative로 변경 -->
			<div class="navbar-1"
				style="position: relative; display: flex; align-items: center; padding: 10px 10px; margin: 0 50px; color: #707070;">

				<!-- 슬라이드 카드 컨테이너: 절대 위치로 가운데 정렬 -->
				<div id="slide-containerv2"
					style="position: absolute; left: 50%; transform: translateX(-50%); width: 217px; height: 50px; display: flex; justify-content: center; align-items: center;">
					<div id="todaySingleCard"
						style="position: relative; width: 217px; height: 50px; overflow: hidden;"></div>
				</div>

				<!-- 오른쪽 메뉴: margin-left auto로 오른쪽 끝 정렬 -->
				<div
					style="margin-left: auto; display: flex; gap: 10px; align-items: center; z-index: 10;">
					<span><a th:href="@{/baseball/day}">경기일정</a></span> <span
						sec:authorize="isAnonymous()"> <a th:href="@{/member/join}">회원가입</a>
						<a th:href="@{/member/login}">로그인</a>
					</span> <span sec:authorize="isAuthenticated()"> <a
						th:href="@{/logout}">로그아웃</a>
					</span> <span sec:authorize="hasRole('USER')"> <a
						th:href="@{/member/mypage}">마이페이지</a>
					</span> <span sec:authorize="hasRole('ADMIN')"> <a
						th:href="@{/admin/adminPage}">관리자페이지</a>
					</span>
				</div>
			</div>

			<div class="navbar-2">
				<a class="navbar-brand" th:href="@{/}">tradeZone</a>

				<form class="search-box" action="" method="get">
					<input class="search-txt" type="text" placeholder="원하시는 상품명을 입력하세요">
					<button class="search-btn" type="submit">
						<i class="fa-solid fa-magnifying-glass"></i>
					</button>
				</form>

				<div class="sub-bar">
					<a th:href="@{/items/new}">판매하기</a> <a th:href="@{/chat}">채팅하기</a>
					<a th:href="@{/notice}">공지사항</a>
				</div>
			</div>
			<div class="navbar-3">
				<ul>
					<li th:each="parent : ${categories}">
						<div class="parent-category">
							<img th:src="${parent.imgUrl}" alt="카테고리 이미지" />
						</div>
						<ul>
							<li th:each="child : ${parent.children}"><a
								th:href="@{/items/category/{parentId}/{childId}(parentId=${parent.id}, childId=${child.id})}">
									<span th:text="${child.name}"></span>
							</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<script >
        let singleCardGames = [];
        let currentCardIndex = 0;
        let singleCardTimer = null;
        const singleCardDelay = 6000; // 7초

        function getSingleCardStatus(status) {
          switch (status) {
            case "BEFORE": return "경기 전";
            case "PLAY": return "진행중";
            case "END": return "종료됨";
            case "CANCEL": return "취소됨";
            default: return "";
          }
        }

        function formatGameTime(time) {
          if (!time) return "";
          return `(${time.slice(0, 2)}:${time.slice(2)})`;
        }

        function createSlideElement(game) {
          const defaultLogo = "https://via.placeholder.com/30?text=팀";
          const homeScore = game.homeResult ?? '';
          const awayScore = game.awayResult ?? '';
          const statusText = getSingleCardStatus(game.gameStatus);
          const gameTime = formatGameTime(game.startTime);

          const wrapper = document.createElement("div");
          wrapper.setAttribute("style", `
            position: absolute;
            top: 50%;
            left: 100%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            transition: left 0.7s ease-in-out;
            font-size: 11px;
          `);

          wrapper.innerHTML = `
            <div style="display:flex; align-items:center; justify-content:center; gap:6px;">
              <img src="${game.homeTeamImageUrl || defaultLogo}" onerror="this.src='${defaultLogo}'" style="width:30px; height:30px; object-fit:contain;"/>
              <span style="font-weight:bold; line-height:1.2;">${game.homeTeamName}</span>
              <span style="font-weight:bold; line-height:1.2;">${homeScore}</span>
              <span style="font-weight:bold; line-height:1.2;">-</span>
              <span style="font-weight:bold; line-height:1.2;">${awayScore}</span>
              <span style="font-weight:bold; line-height:1.2;">${game.awayTeamName}</span>
              <img src="${game.awayTeamImageUrl || defaultLogo}" onerror="this.src='${defaultLogo}'" style="width:30px; height:30px; object-fit:contain;"/>
            </div>
            <div style="font-size:11px; color:#666; line-height:1.2;">
              ${statusText} ${gameTime}
            </div>
          `;

          return wrapper;
        }

        function renderSingleCardSlide() {
          const container = document.getElementById("todaySingleCard");
          if (!singleCardGames.length) {
            container.innerHTML = `<span style="color:#888; font-size:12px;">오늘 경기가 없습니다.</span>`;
            return;
          }

          const game = singleCardGames[currentCardIndex];
          const newCard = createSlideElement(game);

          const oldCard = container.querySelector(".slide-card");
          if (oldCard) {
            oldCard.style.left = "-100%";
            setTimeout(() => {
              if (oldCard.parentNode) oldCard.remove();
            }, 700);
          }

          newCard.classList.add("slide-card");
          container.appendChild(newCard);

          setTimeout(() => {
            newCard.style.left = "0%";
          }, 50);

          currentCardIndex = (currentCardIndex + 1) % singleCardGames.length;
        }

        function startSingleCardSlider() {
          if (singleCardTimer) clearInterval(singleCardTimer);
          if (singleCardGames.length <= 0) return;

          renderSingleCardSlide();
          singleCardTimer = setInterval(renderSingleCardSlide, singleCardDelay);
        }

        function loadSingleCardGames() {
        	fetch('/baseball/today')
        	  .then(res => res.json())
        	  .then(data => {
        	    const schedule = data.schedule;
        	    const todayKey = Object.keys(schedule)[0]; // 예: "20250902"
        	    singleCardGames = schedule[todayKey] || [];
        	    currentCardIndex = 0;
        	    startSingleCardSlider();
        	  })
        	  .catch(err => {
        	    console.error("오늘 경기 카드 API 오류:", err);
        	    document.getElementById("todaySingleCard").innerHTML = `<span style="color:red; font-size:12px;">로딩 실패</span>`;
        	  });
        }

        window.addEventListener('DOMContentLoaded', loadSingleCardGames);
      </script>
		</div>
	</th:block>
</body>